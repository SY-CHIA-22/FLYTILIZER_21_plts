---
output:
  pdf_document: 
    toc: true
    fig_caption: true
    number_sections: true
  html_document: default
editor_options: 
  chunk_output_type: console
---

# SEED GERMINATION

```{r, echo=TRUE, message=FALSE, warning=FALSE}

# 1. Install required packages (if not already installed)
if (!require(tidyverse)) install.packages("tidyverse", dependencies = TRUE)
if (!require(car)) install.packages("car", dependencies = TRUE)

# 2. Load necessary libraries
library(tidyverse)  # For data manipulation and visualization
library(car)         # For ANOVA and Type II SS

# 3. Read in the data
data <- read.table("Germination_Flytilizer_Final.txt", header = TRUE, sep = "\t")


# 4. Check the structure of the data
str(data)

# 5. Convert variables to appropriate types
data$amendment <- as.factor(data$amendment)
data$plant_species <- as.factor(data$plant_species)
data$germ_success <- as.factor(data$germ_success)  # If germination success is categorical (e.g., 0/1)
data$germ_time <- as.numeric(data$germ_time)

# Confirm the changes in structure
str(data)

# 6. Chi-Square Test for Germination Success
contingency_table <- table(data$amendment, data$germ_success)
chi_test <- chisq.test(contingency_table)

# Print the Chi-Square test results
print("Chi-Square Test Results:")
print(chi_test)

##########

# Perform Chi-Square Test for each plant species
plant_species_list <- unique(data$plant_species)  # Get the list of plant species

# Loop through each plant species and perform the chi-square test
for (species in plant_species_list) {
  # Subset the data for the current plant species
  subset_data <- subset(data, plant_species == species)
  
  # Check if the data has enough levels for a Chi-Square Test
  if (nrow(subset_data) > 1 && 
      length(unique(subset_data$amendment)) > 1 && 
      length(unique(subset_data$germ_success)) > 1) {
    
    # Create a contingency table for the current subset
    contingency_table <- table(subset_data$amendment, subset_data$germ_success)
    
    # Perform the Chi-Square Test
    chi_test <- chisq.test(contingency_table)

    # Print results with immediate flushing to the console
    cat("\n==============================\n")
    cat("Chi-Square Test Results for Plant Species:", species, "\n\n")
    cat("Contingency Table:\n")
    print(contingency_table)  # Print contingency table
    cat("\nChi-Square Test Output:\n")
    print(chi_test)  # Print Chi-Square test results
    cat("==============================\n")

    # Force flush the output buffer to display results immediately
    flush.console()

  } else {
    # Print a message if the test can't be performed
    cat("\n==============================\n")
    cat("Chi-Square Test cannot be performed for Plant Species:", species, 
        "due to insufficient levels of amendment or germination success.\n")
    cat("==============================\n")
    
    # Force flush to ensure message is displayed
    flush.console()
  }
}

##################################
# Create a small test dataset
data <- data.frame(
  amendment = rep(c("amended", "unamended"), each = 10),
  plant_species = rep(c("Maize", "Wheat"), times = 10),
  germ_success = c(1, 0, 1, 1, 0, 1, 1, 0, 1, 0, 
                   1, 1, 0, 1, 0, 0, 1, 0, 1, 1)
)

# Check the structure
str(data)

# Perform the looped Chi-Square test for each plant species
plant_species_list <- unique(data$plant_species)

for (species in plant_species_list) {
  subset_data <- subset(data, plant_species == species)
  
  # Check if valid data for Chi-Square
  if (length(unique(subset_data$amendment)) > 1 && 
      length(unique(subset_data$germ_success)) > 1) {
    
    contingency_table <- table(subset_data$amendment, subset_data$germ_success)
    chi_test <- chisq.test(contingency_table)

    cat("\n==============================\n")
    cat("Chi-Square Test for Plant Species:", species, "\n")
    print(contingency_table)
    print(chi_test)
    cat("==============================\n")
    flush.console()
  } else {
    cat("\nInsufficient data for Chi-Square Test for Plant Species:", species, "\n")
  }
}





# 7. Two-Way ANOVA for Germination Time
anova_model <- aov(germ_time ~ amendment * plant_species, data = data)

# Print the ANOVA summary
print("Two-Way ANOVA Results:")
summary(anova_model)

# 8. Optional: Post-hoc Tukey's HSD test if significant effects are found
tukey_test <- TukeyHSD(anova_model)
print("Tukey's HSD Test Results:")
print(tukey_test)

# 9. Visualization: Boxplot for Germination Time by Amendment and Plant Species
ggplot(data, aes(x = amendment, y = germ_time, fill = plant_species)) +
  geom_boxplot() +
  labs(title = "Germination Time by Amendment and Plant Species", 
       x = "Amendment", y = "Germination Time") +
  theme_minimal()

```
